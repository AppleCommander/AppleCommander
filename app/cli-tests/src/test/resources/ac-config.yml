commands:
  ac:
    main-class: com.webcodepro.applecommander.ui.ac
    system-exit: no
    executable: app/cli-ac/build/native/nativeCompile/ac-*

files:
  txtfile:
    type: text
    # See: https://www.lipsum.com/
    content: |
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna
      aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
      occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
  basfile:
    type: text
    content: |
      10 TEXT : HOME
      20 PRINT "HELLO, WORLD"
      30 END
  binfile:
    type: binary
    # Address $300
    content: |
      20 2f fb 20 58 fc a0 0b b9 14 03 20 ed fd 88 d0
      f7 20 8e fd 60 c4 cc d2 cf d7 a0 cf cc cc c5 c8
  testdisk.dsk:
    type: temporary
    prefix: testdisk
    suffix: .dsk
  testdisk.po:
    type: temporary
    prefix: testdisk
    suffix: .po

tests:
  - name: ticket192
    variables:
      # All arrays must be same length -- only iterated over, not matrixed
      flag: ["-dos140", "-pro140", "-pas140"]
      volname: ["", "TEST", "TEST"] # blank will be skipped
      disk: ["$testdisk.dsk", "$testdisk.po", "$testdisk.po"]
    steps:
      - command: ac $flag $disk $volname
      - command: ac -pt $disk TESTFILE
        stdin: $txtfile
      - command: ac -d $disk TESTFILE
      - command: ac -pt $disk TESTFILE
        stdin: $txtfile
  - name: big exercise
    variables:
      flag: ["-dos140", "-pro140"]
      volname: ["", "TEST"]
      disk: ["$testdisk.dsk", "$testdisk.po"]
      format: ["Disk Format: DOS 3.3", "Disk Format: ProDOS"]
      directory:
        - |
          .*T 003 TEXTFILE.*
          .*A 002 BASFILE.*
          .*B 002 BINFILE.*
        - |
          .*TEXTFILE TXT 001.*
          .*BASFILE BAS 001.*
          .*BINFILE BIN 001.*
    steps:
      # Create our image
      - command: ac $flag $disk $volname
      - command: ac -pt $disk TEXTFILE
        stdin: $txtfile
      - command: ac -bas $disk BASFILE
        stdin: $basfile
      - command: ac -p $disk BINFILE BIN 0x300
        stdin: $binfile
      # List image
      - command: ac -i $disk
        criteria:
          match: contains
        stdout: $format
      - command: ac -l $disk
        criteria:
          match: regex
          whitespace: ignore
        stdout: $directory
      # Verify contents of files
      - command: ac -e $disk TEXTFILE
        stdout: $txtfile
      - command: ac -e $disk BASFILE
        criteria:
          whitespace: trim
        stdout: |
          10  TEXT : HOME 
          20  PRINT "HELLO, WORLD"
          30  END
      # 'ac' doesn't disassemble
      - command: ac -e $disk BINFILE
        stdout: |
          Offset   Hex Data                                          Characters
          =======  ================================================  =================
          $000300  20 2F FB 20 58 FC A0 0B  B9 14 03 20 ED FD 88 D0   /{ X| . 9.. m}.P
          $000310  F7 20 8E FD 60 C4 CC D2  CF D7 A0 CF CC CC C5 C8  w .}`DLR OW OLLEH
          ** END **
